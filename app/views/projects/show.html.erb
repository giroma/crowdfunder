  <h1><%= @project.title %></h1>

<% if current_user == @project.user %>
  <h1>Welcome back, <%= current_user.first_name %>!</h1>
  <h2>Here's how your project's doing so far...</h2>
  <h3>People who have backed your project</h3>
  <ul>
    <%# CHECK IF WE CAN IMPROVE LOGIC BEHIND %>
    <% if @pledgers != nil %>
    <% @pledgers.each do |pledger| %>
      <li><%= pledger.first_name %> <%= pledger.last_name %></li>
    <% end  %>
    <% end %>
  </ul>
    <hr />
<% end  %>

<% if @project.image.present? %>
  <%= image_tag @project.image %>
<% end %>

<p><%= @project.description %></p>
<p>Goal: <%= number_to_currency(@project.goal) %></p>
<p>Fundraising starts: <%= @project.start_date.strftime("%A %b %d %Y") %></p>
<p>Deadline: <%= @project.end_date.strftime("%A %b %d %Y") %></p>
<%= link_to "Check out the owner's page", user_path(@user) %>
<p>Total Pledged: $<%= @total_pledged %></p>
<%= form_for [@project, Pledge.new] do |f| %>
  <%= f.number_field :dollar_amount, value: @project.rewards.minimum(:dollar_amount), step: 0.01 %>
  <%= f.submit "Pledge" %>
<% end %>
<h2>Rewards</h2>
<% @project.rewards.each do |reward| %>
  <p><%= number_to_currency(reward.dollar_amount) %></p>
  <p><%= reward.description %></p>
  <% if current_user == nil %>

  <% elsif current_user.id == @project.user_id %>

  <p>
    <small>
      <%= link_to "Remove reward", project_reward_path(@project, reward), method: 'delete' %>
    </small>
  </p>


<%= link_to "Add new reward", new_project_reward_path(@project) %>
<% end %>
<% end %>

  <h2>Project Comments</h2>
  <ul>
    <% @project.comments.each do |comment| %>
      <li>
        <p><%= comment.comment %></p>
        <p>Posted on: <%= comment.created_at %></p>
        <% if @pledger != nil && @pledger.pluck(:project_id).include?(@project.id) %>
          <p><%= link_to "Edit Comment", edit_project_comment_path(@project, comment)%> | <%= link_to "Delete", project_comment_path(@project, comment), method: :delete, data: {confirm: "Are you sure you want to delete this review?" } %> </p>
        <% end %>
      </li>
      <% end %>
  </ul>

<!-- comment form only displays if user pledged project -->
<% if @pledger != nil && @pledger.pluck(:project_id).include?(@project.id) %>
  <h4>New Comment</h4>
  <%= render '/comments/form', comment: @comment %>
<% end %>
